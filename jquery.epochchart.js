// Generated by CoffeeScript 1.3.3

(function($) {
  var defaults;
  defaults = {
    marker: 'url(marker.png)'
  };
  return $.fn.epochchart = function(lines, markers, opts) {
    var chart, defaultHighchartsOpts, highchartsOpts, markerData, markerLine, maxY;
    if (opts == null) {
      opts = {};
    }
    opts = $.extend(true, {}, defaults, opts);
    if (Object.prototype.toString.call(lines) !== '[object Array]') {
      lines = [lines];
    }
    defaultHighchartsOpts = {
      title: {
        text: null
      },
      xAxis: {
        type: 'datetime',
        dateTimeLabelFormats: {
          month: '%e. %b',
          year: '%b'
        }
      },
      yAxis: {
        title: {
          text: null
        },
        plotLines: [
          {
            value: 0,
            width: 1,
            color: '#808080'
          }
        ]
      },
      tooltip: {
        shared: true,
        crosshairs: true
      },
      plotOptions: {
        scatter: {
          marker: {
            symbol: opts['marker'],
            states: {
              hover: {
                enabled: true,
                lineColor: 'rgb(100,100,100)'
              }
            }
          },
          states: {
            hover: {
              marker: {
                enabled: false
              }
            }
          },
          tooltip: {
            enabled: true,
            headerFormat: '',
            pointFormat: '{point.name}'
          }
        },
        spline: {
          marker: {
            enabled: false
          }
        }
      },
      legend: {
        enabled: false
      }
    };
    highchartsOpts = $.extend(true, defaultHighchartsOpts, opts['highchartsOpts']);
    maxY = null;
    lines = $.map(lines, function(line) {
      var lineData;
      lineData = $.map(line.data, function(data) {
        console.log(data[0]);
        if (maxY === null || data[1] > maxY) {
          maxY = data[1];
        }
        return {
          x: new Date(data[0]),
          y: data[1]
        };
      });
      return {
        type: 'spline',
        name: line.name,
        data: lineData
      };
    });
    markerData = $.map(markers, function(marker) {
      return {
        x: new Date(marker[0]),
        y: 1.03 * maxY,
        name: marker[1]
      };
    });
    markerLine = {
      type: 'scatter',
      name: 'Markers',
      data: markerData
    };
    lines.push(markerLine);
    console.log(lines);
    chart = $.extend(true, highchartsOpts, {
      series: lines
    });
    return $(this).highcharts(chart);
  };
})(jQuery);
